trigger:
- master

pool:
  name: 'shu'   # self-hosted pool của bạn

steps:
# 1. Install Node.js
- task: NodeTool@0
  inputs:
    versionSpec: '18.x'
  displayName: 'Install Node.js 18'

# 2. Install dependencies
- powershell: |
    Write-Host "Installing dependencies..."
    npm install
  displayName: 'Install dependencies'

# 3. Build (optional)
- powershell: |
    if (Test-Path "package.json") {
      if ((Get-Content package.json) -match '"build"') {
        Write-Host "Building project..."
        npm run build
      } else {
        Write-Host "Không có script build, skip build"
      }
    } else {
      Write-Host "Không tìm thấy package.json, skip build"
    }
  displayName: 'Build project'

# 4. Test (optional)
- powershell: |
    if ((Get-Content package.json) -match '"test"') {
      Write-Host "Running tests..."
      npm test
    } else {
      Write-Host "Không có test, skip test"
    }
  displayName: 'Run tests'
